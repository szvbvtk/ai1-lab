<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Map Jigsaw Puzzle</title>

    <script src="leaflet-1.7.1/leaflet-src.js"></script>
    <script src="leaflet-1.7.1/leaflet-providers.js"></script>
    <script src="leaflet-1.7.1/leaflet-image.js"></script>

    <link rel="stylesheet" href="leaflet-1.7.1/leaflet.css">
    
    <style>
      #map-container {
        display: flex;
      }

      #map {
        width: 600px;
        height: 300px;
        border: 1px solid black;
      }

      #rasterMap {
        width: 600px;
        height: 300px;
        border: 1px solid black;
        margin-left: 30px;
        position: relative;
      }

      .puzzle-piece {
        width: 150px;
        height: 75px;
        float: left;
        border: 1px solid black;
        cursor: grab;
      }
      
      .canvas-cell {
        width: 150px;
        height: 75px;
        position: absolute;
        border: 1px solid black;
        overflow: hidden;
      }
    </style>

  </head>
  <body>
    <div id="map-container">
      <div id="map"></div>
      <div id="rasterMap"></div>
    </div>
    <br>
    <button id="getLocation">Get Current Location</button>
    <button id="saveButton">Save Raster Map</button>
    <br>
    <div id="puzzle"></div>

    <script>
      let map = L.map("map").setView([53.430127, 14.564802], 18);
      L.tileLayer.provider("Esri.WorldImagery").addTo(map);
      let marker = L.marker([53.430127, 14.564802]).addTo(map);
      marker.bindPopup("<strong>Hello!</strong><br>This is a popup.");

      document.getElementById("saveButton").addEventListener("click", function () {
        leafletImage(map, function (err, canvas) {
          // Clear the existing puzzle pieces
          document.getElementById("puzzle").innerHTML = "";
          document.getElementById("rasterMap").innerHTML = "";

          // Split the map into 16 pieces and display them as puzzle pieces
          for (let i = 0; i < 16; i++) {
            const piece = document.createElement("div");
            piece.className = "puzzle-piece";
            piece.style.backgroundImage = `url(${canvas.toDataURL()})`;
            piece.style.backgroundPosition = `-${i % 4 * 150}px -${Math.floor(i / 4) * 75}px`;
            piece.draggable = true;
            piece.dataset.pieceNumber = i;

            // Add a drag and drop event listeners
            piece.addEventListener("dragstart", function (event) {
              event.dataTransfer.setData("text/plain", i);
            });

            document.getElementById("puzzle").appendChild(piece);
          }
          
          // Create 16 canvas cells for dropping puzzle pieces
          for (let i = 0; i < 16; i++) {
            const cell = document.createElement("div");
            cell.className = "canvas-cell";
            cell.style.left = (i % 4 * 150) + "px";
            cell.style.top = (Math.floor(i / 4) * 75) + "px";
            cell.dataset.cellNumber = i;

            // Add a drop event listener
            cell.addEventListener("dragover", function (event) {
              event.preventDefault();
            });

            cell.addEventListener("drop", function (event) {
              event.preventDefault();
              const pieceNumber = event.dataTransfer.getData("text/plain");
              const piece = document.querySelector(`[data-piece-number="${pieceNumber}"]`);
              piece.style.position = "absolute";
              piece.style.left = "0";
              piece.style.top = "0";
              cell.appendChild(piece);
            });

            document.getElementById("rasterMap").appendChild(cell);
          }
        });
      });

      document.getElementById("getLocation").addEventListener("click", function (event) {
        if (!navigator.geolocation) {
          console.log("No geolocation.");
        }

        navigator.geolocation.getCurrentPosition(
          (position) => {
            console.log(position);
            let lat = position.coords.latitude;
            let lon = position.coords.longitude;

            map.setView([lat, lon]);
          },
          (positionError) => {
            console.error(positionError);
          }
        );
      });

      const puzzlePieces = document.querySelectorAll(".puzzle-piece");
      puzzlePieces.forEach((piece) => {
        piece.addEventListener("dragstart", function (event) {
          event.dataTransfer.setData("text/plain", piece.dataset.pieceNumber);
        });
      });
    </script>
  </body>
</html>

<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Map Jigsaw Puzzle</title>

    <script src="leaflet-1.7.1/leaflet-src.js"></script>
    <script src="leaflet-1.7.1/leaflet-providers.js"></script>
    <script src="leaflet-1.7.1/leaflet-image.js"></script>

    <link rel="stylesheet" href="leaflet-1.7.1/leaflet.css" />

    <style>
      #map-container {
        display: flex;
      }

      #map {
        width: 600px;
        height: 300px;
        border: 1px solid black;
      }

      #rasterMap {
        width: 600px;
        height: 300px;
        border: 1px solid black;
        margin-left: 30px;
        position: relative;
      }

      .puzzle-piece {
        width: 150px;
        height: 75px;
        float: left;
        border: 1px solid black;
        cursor: grab;
      }

      .canvas-cell {
        width: 150px;
        height: 75px;
        position: absolute;
        border: 1px solid black;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="map-container">
      <div id="map"></div>
      <div id="rasterMap"></div>
    </div>
    <br />
    <button id="getLocation">Get Current Location</button>
    <button id="saveButton">Save Raster Map</button>
    <br />
    <div id="puzzle"></div>

    <script>
      let map = L.map("map").setView([53.430127, 14.564802], 18);
      L.tileLayer.provider("Esri.WorldImagery").addTo(map);
      // let marker = L.marker([53.430127, 14.564802]).addTo(map);
      // marker.bindPopup("<strong>Hello!</strong><br>This is a popup.");

      document
        .getElementById("saveButton")
        .addEventListener("click", () =>{
          leafletImage(map, (err, canvas) => {
            // Clear the existing puzzle pieces
            document.getElementById("puzzle").innerText = "";
            document.getElementById("rasterMap").innerText = "";

            canvasData = canvas.toDataURL();

            // Split the map into 16 pieces and display them as puzzle pieces
            for (let i = 0; i < 4*4; i++) {
              const piece = document.createElement("div");
              piece.className = "puzzle-piece";
              piece.style.backgroundImage = `url(${canvasData})`;
              piece.style.backgroundPosition = `-${(i % 4) * 150}px -${
                Math.floor(i / 4) * 75
              }px`;
              piece.draggable = true;
              piece.dataset.pieceNumber = i;

              // Add a drag and drop event listeners
              piece.addEventListener("dragstart", function (event) {
                event.dataTransfer.setData("text/plain", i);
              });

              document.getElementById("puzzle").appendChild(piece);
            }

            // Create 16 canvas cells for dropping puzzle pieces
            for (let i = 0; i < 16; i++) {
              const cell = document.createElement("div");
              cell.className = "canvas-cell";
              cell.style.left = (i % 4) * 150 + "px";
              cell.style.top = Math.floor(i / 4) * 75 + "px";
              cell.dataset.cellNumber = i;

              // Add a drop event listener
              cell.addEventListener("dragover", function (event) {
                event.preventDefault();
              });

              cell.addEventListener("drop", function (event) {
                event.preventDefault();
                const pieceNumber = event.dataTransfer.getData("text/plain");
                const piece = document.querySelector(
                  `[data-piece-number="${pieceNumber}"]`
                );
                piece.style.position = "absolute";
                piece.style.left = "0";
                piece.style.top = "0";
                cell.appendChild(piece);
              });

              document.getElementById("rasterMap").appendChild(cell);
            }
          });
        });

      document
        .getElementById("getLocation")
        .addEventListener("click", function (event) {
          if (!navigator.geolocation) {
            console.log("No geolocation.");
          }

          navigator.geolocation.getCurrentPosition(
            (position) => {
              console.log(position);
              let lat = position.coords.latitude;
              let lon = position.coords.longitude;

              map.setView([lat, lon]);
            },
            (positionError) => {
              console.error(positionError);
            }
          );
        });

      const puzzlePieces = document.querySelectorAll(".puzzle-piece");
      puzzlePieces.forEach((piece) => {
        piece.addEventListener("dragstart", function (event) {
          event.dataTransfer.setData("text/plain", piece.dataset.pieceNumber);
        });
      });
    </script>
  </body>
</html> -->

